<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Měnové Kurzy</title>
    <meta property="og:title" content="Aktuální Měnové Kurzy">
    <meta property="og:description" content="Zjistěte aktuální měnové kurzy">
    <meta property="og:image" content="https://example.com/your-image.jpg"> <!-- Změň na URL obrázku -->
    <meta property="og:url" content="https://example.com"> <!-- Změň na URL tvého webu -->
    <meta property="og:type" content="website">
    <meta property="og:locale" content="cs_CZ">
    <meta property="og:site_name" content="Měnové Kurzy">
    
    <!-- OG data pro kurz USD na CZK -->
    <meta property="og:usd_to_czk" content="1 CZK = ... USD">
    
    <!-- OG data pro kurz EUR na CZK -->
    <meta property="og:eur_to_czk" content="1 CZK = ... EUR">

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            text-align: center;
            padding: 50px;
        }
        #exchange-rate {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: inline-block;
            margin-top: 20px;
        }
        select, input {
            padding: 10px;
            margin: 10px;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Aktuální Měnové Kurzy</h1>
    <div>
        <input type="number" id="amount" placeholder="Zadejte částku" value="1">
        <select id="from-currency">
            <option value="USD">USD</option>
            <option value="CZK">CZK</option>
            <!-- Můžeš přidat další měny dle potřeby -->
        </select>
        <select id="to-currency">
            <option value="CZK">CZK</option>
            <option value="USD">USD</option>
            <!-- Můžeš přidat další měny dle potřeby -->
        </select>
        <button onclick="convertCurrency()">Převést</button>
    </div>
    <div id="exchange-rate">
        <p>Načítání...</p>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const apiUrl = '/api';
        
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.result === "success") {
                        window.exchangeRates = data.conversion_rates;
                        updateExchangeRates(); // Aktualizujeme kurzy při načtení stránky
                        saveExchangeRatesToAPI(data.conversion_rates);
                    } else {
                        alert('Nepodařilo se načíst data. Zkontrolujte svůj API klíč.');
                    }
                })
                .catch(error => {
                    console.error('Chyba při načítání dat:', error);
                    alert('Nastala chyba při načítání dat.');
                });
        });
        
        function convertCurrency() {
            const amount = document.getElementById('amount').value;
            const fromCurrency = document.getElementById('from-currency').value;
            const toCurrency = document.getElementById('to-currency').value;
        
            if (window.exchangeRates) {
                const fromRate = window.exchangeRates[fromCurrency];
                const toRate = window.exchangeRates[toCurrency];
                const convertedAmount = (amount / fromRate) * toRate;
        
                const exchangeRateDiv = document.getElementById('exchange-rate');
                let html = `<h2>${amount} ${fromCurrency} na ${toCurrency}</h2>`;
                html += `<p>${amount} ${fromCurrency} = ${convertedAmount.toFixed(2)} ${toCurrency}</p>`;
                exchangeRateDiv.innerHTML = html;
            } else {
                alert('Kurzovní lístek není načten. Prosím, znovu načtěte stránku.');
            }
        }
        
        function updateExchangeRates() {
            setInterval(() => {
                fetch('/api')
                    .then(response => response.json())
                    .then(data => {
                        if (data.result === "success") {
                            window.exchangeRates = data.conversion_rates;
                            saveExchangeRatesToAPI(data.conversion_rates);
                        } else {
                            console.error('Nepodařilo se aktualizovat kurzy.');
                        }
                    })
                    .catch(error => {
                        console.error('Chyba při aktualizaci kurzu:', error);
                    });
            }, 60000); // Aktualizace každou minutu (60000 ms)
        }
        
        function saveExchangeRatesToAPI(rates) {
            const apiUrl = `/api`;
            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(rates)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Nepodařilo se uložit data na API.');
                }
                console.log('Data úspěšně uložena na API.');
            })
            .catch(error => {
                console.error('Chyba při ukládání dat na API:', error);
            });
        }
    </script>
</body>
</html>
